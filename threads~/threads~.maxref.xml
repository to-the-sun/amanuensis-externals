<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<?xml-stylesheet devhelp="true" type="text/xsl" href="pb-patcher.xsl"?>
<c74object name="threads~" module="msp" category="Utility">
	<digest>Writes incoming track data into a polybuffer~</digest>
	<description>
		The `threads~` object receives 4-item lists (palette, track, bar, offset) and writes them into a named `polybuffer~`. It uses a palette-to-channel mapping to determine which channel of a buffer to write to. Special values like 0 and -999999 are handled according to a specific multi-channel writing protocol.
	</description>
	<!--METADATA-->
	<metadatalist>
		<metadata name="author">Jules</metadata>
		<metadata name="tag">Utility</metadata>
	</metadatalist>
	<!--INLETS-->
	<inletlist>
		<inlet id="0" type="signal/list">
			<digest>Time ramp (signal) or Data List [palette, track, bar, offset]</digest>
			<description>Accepts an audio signal (treated as a time ramp in milliseconds) or the 4-item list from crucible or a similar source. Also accepts anything messages (like reach updates) on this inlet, or the symbol 'clear' to clear all buffers and the visualizer. Note: The 'clear' operation is synchronous and blocks the message thread until all buffers are cleared.</description>
		</inlet>
		<inlet id="1" type="symbol">
			<digest>Rescript/Reference dictionary name</digest>
			<description>Accepts a symbol denoting an external dict to reference. This triggers a rescript of the track data and sets a reference for audio-rate ramp processing. When the input ramp signal hits bar timestamp keys in the dictionary, data and "silence caps" are automatically generated and processed.</description>
		</inlet>
		<inlet id="2" type="list">
			<digest>Palette Configuration</digest>
			<description>Accepts [palette_name, channel_index] pairs to register palettes, or the symbol 'clear' to reset all mappings.</description>
		</inlet>
	</inletlist>
	<!--OUTLETS-->
	<outletlist>
		<outlet id="0" type="anything">
			<digest>Verbose Logging Outlet</digest>
			<description>Outputs diagnostic information when the verbose attribute is enabled.</description>
		</outlet>
	</outletlist>
	<!--ARGUMENTS-->
	<objarglist>
		<objarg name="polybuffer_prefix" type="symbol" optional="0">
			<digest>Prefix for the polybuffer~ members</digest>
			<description>The base name of the polybuffer~ (e.g., if prefix is 'script', it will look for 'script.1', 'script.2', etc.).</description>
		</objarg>
	</objarglist>
	<!--MESSAGES-->
	<methodlist>
		<method name="list">
			<digest>Process data list</digest>
			<description>Parses the 4-item list and writes data to the appropriate buffer and channel.</description>
		</method>
		<method name="dsp64">
			<digest>DSP method</digest>
			<description>Registers the audio-rate perform routine when a signal is connected to the first inlet. This allows tracking an input ramp for automated dictionary processing.</description>
		</method>
		<method name="anything">
			<digest>Register palette or clear</digest>
			<description>Used on the third inlet to map palette names to channel indices or clear the map. On the second inlet, a symbol triggers the rescript functionality. On the first inlet, handles formatted messages similar to the data list, or the symbol 'clear' to reset all buffers and the visualizer (synchronously).</description>
		</method>
		<method name="rescript">
			<arglist>
				<arg name="dictionary_name" type="symbol" optional="0" />
			</arglist>
			<digest>Process track data from an external dictionary (Inlet 1)</digest>
			<description>Triggers when a symbol is received on the second inlet (Inlet 1). Retrieves data from the named dictionary (matching the sampletranscript.json format) and processes it as if it entered the first inlet. It also automatically generates "silence caps" for missing bar timestamps based on the bar_length value found in a buffer~ named 'bar'.</description>
		</method>
	</methodlist>
	<!--ATTRIBUTES-->
	<attrlist>
		<attr name="verbose" type="long" get="1" set="1" opaque="0">
			<digest>Enable Verbose Logging</digest>
			<description>When set to 1, the object outputs diagnostic information and sends data to the visualizer script.</description>
		</attr>
	</attrlist>
	<!--SEEALSO-->
	<seealsolist>
		<seealso name="crucible" />
		<seealso name="polybuffer~" />
		<seealso name="buffer~" />
		<seealso name="buildspans" />
		<seealso name="whichoffset" />
		<seealso name="notify" />
		<seealso name="growbuffer~" />
	</seealsolist>
</c74object>
