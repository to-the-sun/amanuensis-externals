<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<?xml-stylesheet devhelp="true" type="text/xsl" href="pb-patcher.xsl"?>
<c74object name="crucible" module="max" category="Analysis">
	<digest>Selectively updates a dictionary by comparing incoming spans</digest>
	<description>
		The `crucible` object implements a challenger/incumbent system for updating a dictionary. It receives streams of messages representing musical spans (typically from `buildspans`) and stores them as a "challenger". When a complete span is received, it compares the rating of each bar in the challenger to the corresponding bar in an "incumbent" dictionary. The challenger only overwrites the incumbent if every bar rating is strictly higher. It also supports a "song fill" feature to expand tracks to match the longest reach.
	</description>
	<!--METADATA-->
	<metadatalist>
		<metadata name="author">Jules</metadata>
		<metadata name="tag">Analysis</metadata>
	</metadatalist>
	<!--INLETS-->
	<inletlist>
		<inlet id="0" type="anything">
			<digest>Message stream from buildspans</digest>
			<description>Receives messages describing bars and spans (track::bar::key value or span list).</description>
		</inlet>
		<inlet id="1" type="float">
			<digest>Local Bar Length</digest>
			<description>Sets a local bar length that overrides the buffer value. A value &lt;= 0 reverts to using the buffer.</description>
		</inlet>
	</inletlist>
	<!--OUTLETS-->
	<outletlist>
		<outlet id="0" type="int">
			<digest>Reach value</digest>
			<description>For a winning span, outputs the reach (largest bar timestamp + bar_length).</description>
		</outlet>
		<outlet id="1" type="symbol">
			<digest>Palette value</digest>
			<description>For a winning span, outputs the associated palette.</description>
		</outlet>
		<outlet id="2" type="int">
			<digest>Track value</digest>
			<description>For a winning span, outputs the associated track.</description>
		</outlet>
		<outlet id="3" type="int">
			<digest>Bar value</digest>
			<description>For a winning span, outputs each bar timestamp in the span.</description>
		</outlet>
		<outlet id="4" type="float">
			<digest>Offset value</digest>
			<description>For a winning span, outputs the associated offset as a high-precision float.</description>
		</outlet>
		<outlet id="5" type="anything">
			<digest>Verbose Logging (Optional)</digest>
			<description>Status messages when verbose attribute is enabled.</description>
		</outlet>
	</outletlist>
	<!--ARGUMENTS-->
	<objarglist>
		<objarg name="incumbent_dictionary_name" type="symbol" optional="0">
			<digest>The name of the incumbent dictionary</digest>
			<description>Specify the name of a dict object to use for comparisons.</description>
		</objarg>
	</objarglist>
	<!--MESSAGES-->
	<methodlist>
		<method name="anything">
			<digest>Process input data</digest>
			<description>Handles the hierarchical key/value messages and span lists from buildspans.</description>
		</method>
		<method name="ft1">
			<digest>Set local bar length</digest>
			<description>Sets the bar length in milliseconds in the second inlet.</description>
		</method>
	</methodlist>
	<!--ATTRIBUTES-->
	<attrlist>
		<attr name="verbose" get="1" set="1" type="long" size="1">
			<digest>Enable Verbose Logging</digest>
			<description>When enabled (1), creates an additional outlet for status messages.</description>
			<attributelist>
				<attribute name="style" get="1" set="1" type="symbol" size="1" value="onoff" />
			</attributelist>
		</attr>
		<attr name="fill" get="1" set="1" type="long" size="1">
			<digest>Enable Song Fill</digest>
			<description>When enabled (1), automatically grows tracks to match the maximum reach by looping existing content.</description>
			<attributelist>
				<attribute name="style" get="1" set="1" type="symbol" size="1" value="onoff" />
			</attributelist>
		</attr>
	</attrlist>
	<!--SEEALSO-->
	<seealsolist>
		<seealso name="buildspans" />
		<seealso name="crucible" />
		<seealso name="notify" />
		<seealso name="whichoffset" />
		<seealso name="stemversion" />
		<seealso name="createproject" />
		<seealso name="dict" />
	</seealsolist>
</c74object>
