<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<?xml-stylesheet devhelp="true" type="text/xsl" href="pb-patcher.xsl"?>
<c74object name="rebar" module="max" category="Utility">
	<digest>A high-level coordinator for transcript processing and span comparison</digest>
	<description>
		The `rebar` object is a composite utility that encapsulates and coordinates the `notify`, `buildspans`, and `crucible` modules into a single, tightly-coupled workflow. It is designed to process a transcript dictionary, organize its notes into rated bars and spans, and selectively merge them into a destination "incumbent" dictionary based on their quality.

		Upon receiving an integer (bar length) in its first inlet, `rebar` performs the following coordinated steps:
		1. Sets the local bar length for its internal `buildspans` and `crucible` modules.
		2. Triggers a dump of the specified transcript dictionary (via the internal `notify` module).
		3. Routes the resulting note stream through `buildspans` to aggregate bars and calculate span ratings.
		4. Routes completed spans into `crucible`, where they are compared against the incumbent dictionary.
		5. Merges winning (higher-rated) spans into the incumbent dictionary and outputs the results.
	</description>
	<!--METADATA-->
	<metadatalist>
		<metadata name="author">Jules</metadata>
		<metadata name="tag">Utility</metadata>
		<metadata name="tag">Sequencing</metadata>
		<metadata name="tag">Dictionary</metadata>
	</metadatalist>
	<!--INLETS-->
	<inletlist>
		<inlet id="1" type="int">
			<digest>Set bar length and trigger coordinated processing</digest>
			<description>
				Accepts an integer representing the bar length (in milliseconds). This value is passed to the internal `buildspans` and `crucible` modules, followed immediately by a command to dump and process the transcript dictionary.
			</description>
		</inlet>
	</inletlist>
	<!--OUTLETS-->
	<outletlist>
		<outlet id="1" type="list/anything">
			<digest>Outlet 1: Data and Reach Lists</digest>
			<description>Outputs the final data for winning bars and reach-update messages from the internal `crucible` module.</description>
		</outlet>
		<outlet id="2" type="bang">
			<digest>Outlet 2: Fill Bang</digest>
			<description>Sends a bang whenever a new span win causes the total song reach to grow.</description>
		</outlet>
		<outlet id="3" type="int">
			<digest>Outlet 3: Reach Update</digest>
			<description>Outputs the updated total duration (reach) of the incumbent dictionary in milliseconds.</description>
		</outlet>
		<outlet id="4" type="anything">
			<digest>Outlet 4: Consolidated Logging</digest>
			<description>
				When the `@log` attribute is enabled, this outlet provides detailed verbose information from all three internal modules (`notify`, `buildspans`, and `crucible`).
			</description>
		</outlet>
	</outletlist>
	<!--ARGUMENTS-->
	<objarglist>
		<objarg name="dictionary-name" type="symbol" optional="0">
			<digest>The name of the Max dictionary to be used for both input (transcript) and output (incumbent)</digest>
			<description>The object will attempt to bind its internal modules to a registered dictionary with this name. This dictionary serves as the source for the `notify` module and the destination (incumbent) for the `crucible` module.</description>
		</objarg>
	</objarglist>
	<!--MESSAGES-->
	<methodlist>
		<method name="int">
			<digest>Trigger coordinated processing pipeline</digest>
			<description>Sets the internal bar length to the provided value and initiates the sequence: Dump Transcript -> Build Spans -> Compare/Merge into Incumbent.</description>
		</method>
	</methodlist>
	<!--ATTRIBUTES-->
	<attributelist>
		<attribute name="log" get="1" set="1" type="long" size="1">
			<digest>Enable Verbose Logging</digest>
			<description>
				When enabled (1), enables verbose logging for all internal sub-modules and directs the output to the fourth outlet.
			</description>
			<attributelist>
				<attribute name="style" get="1" set="1" type="symbol" size="1" value="onoff" />
			</attributelist>
		</attribute>
		<attribute name="defer" get="1" set="1" type="long" size="1">
			<digest>Deferred Execution</digest>
			<description>
				When enabled (1), moves the processing to the Main (UI) thread for all internal modules, preventing timing jitter in the high-priority threads.
			</description>
			<attributelist>
				<attribute name="style" get="1" set="1" type="symbol" size="1" value="onoff" />
			</attributelist>
		</attribute>
		<attribute name="consume" get="1" set="1" type="long" size="1">
			<digest>Enable Deep Delete (Crucible)</digest>
			<description>
				When enabled (1), enables the 'deep delete' logic in the internal `crucible` module, ensuring that defeated spans are thoroughly removed from the incumbent dictionary.
			</description>
			<attributelist>
				<attribute name="style" get="1" set="1" type="symbol" size="1" value="onoff" />
			</attributelist>
		</attribute>
		<attribute name="visualize" get="1" set="1" type="long" size="1">
			<digest>Enable Visualization (Buildspans)</digest>
			<description>
				When enabled (1), enables the visualization output for the internal `buildspans` module.
			</description>
			<attributelist>
				<attribute name="style" get="1" set="1" type="symbol" size="1" value="onoff" />
			</attributelist>
		</attribute>
	</attributelist>
	<!--SEEALSO-->
	<seealsolist>
		<seealso name="notify" />
		<seealso name="buildspans" />
		<seealso name="crucible" />
		<seealso name="threads~" />
		<seealso name="weaver~" />
		<seealso name="bounce~" />
	</seealsolist>
</c74object>
