<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<?xml-stylesheet devhelp="true" type="text/xsl" href="pb-patcher.xsl"?>
<c74object name="notify" module="max" category="Dictionary">
	<digest>
		Dump all notes from a dictionary ordered by absolute timestamp
	</digest>
	<description>
		The notify object accepts a dictionary name as an argument and, when it receives a bang, it extracts all notes (timestamped events) from the dictionary, sorts them chronologically by absolute timestamp, clears the original dictionary, and outputs the notes sequentially from its outlets. It also references an external buffer~ named 'bar' to determine the current bar length for reporting upcoming bars.
	</description>

	<metadatalist>
		<metadata name="author">Jules</metadata>
		<metadata name="tag">Dictionary</metadata>
	</metadatalist>

	<inletlist>
		<inlet id="1" type="anything">
			<digest>
				bang to trigger dump, fill for specialized dump
			</digest>
			<description>
				A bang message triggers a standard dump. A fill message triggers a specialized dump that fills in gaps in shorter tracks relative to the longest track.
			</description>
		</inlet>
		<inlet id="2" type="float">
			<digest>
				Local Bar Length
			</digest>
			<description>
				Sets a local override for the bar length. If set to 0 (default), the object will instead read the bar length from the first sample of a buffer~ named 'bar'. This value persists across dump operations until manually changed or reset to 0.
			</description>
		</inlet>
	</inletlist>

	<outletlist>
		<outlet id="1" type="list">
			<digest>
				Absolute Timestamp and Score
			</digest>
			<description>
				A 2-item list consisting of the absolute timestamp (float) and the score (float).
			</description>
		</outlet>
		<outlet id="2" type="float">
			<digest>
				Offset
			</digest>
			<description>
				The offset associated with the bar containing the note.
			</description>
		</outlet>
		<outlet id="3" type="int">
			<digest>
				Track
			</digest>
			<description>
				The track number (integer) where the note was found.
			</description>
		</outlet>
		<outlet id="4" type="symbol">
			<digest>
				Palette
			</digest>
			<description>
				The palette name associated with the bar containing the note.
			</description>
		</outlet>
		<outlet id="5" type="list">
			<digest>
				Descript
			</digest>
			<description>
				A 4-item list formatted as: &lt;palette:symbol&gt; &lt;track:int&gt; &lt;bar_timestamp:float&gt; 0.0. These messages are output as a batch at the very beginning of the dump process. For each bar found in the dictionary, a second descript message is sent for the subsequent bar (current + bar_length) if that bar does not already exist in the dictionary.
			</description>
		</outlet>
		<outlet id="6" type="symbol">
			<digest>
				Verbose Logging (Optional)
			</digest>
			<description>
				If the verbose attribute is enabled, this outlet provides status messages.
			</description>
		</outlet>
	</outletlist>

	<objarglist>
		<objarg name="dictionary-name" optional="0" type="symbol">
			<digest>
				Name of the dictionary to reference
			</digest>
			<description>
				The name of the external dict object that notify will read from and clear.
			</description>
		</objarg>
	</objarglist>

	<attributelist>
		<attribute name="verbose" get="1" set="1" type="long" size="1">
			<digest>
				Enable Verbose Logging
			</digest>
			<description>
				When enabled (1), adds a rightmost outlet for verbose logging messages and outputs status information to it.
			</description>
			<attributelist>
				<attribute name="style" get="1" set="1" type="symbol" size="1" value="onoff" />
			</attributelist>
		</attribute>
	</attributelist>

	<methodlist>
		<method name="bang">
			<digest>
				Trigger the dump process
			</digest>
			<description>
				In the leftmost inlet, a bang triggers the gathering of all notes from the referenced dictionary. The notes are then sorted, the dictionary is cleared, and the notes are output sequentially from the outlets.
			</description>
		</method>
		<method name="fill">
			<digest>
				Trigger the specialized fill dump
			</digest>
			<description>
				Triggers a specialized dump that identifies the longest track and fills the gaps in all other tracks by looping their content until they match the reach of the longest track. This dump does NOT clear the dictionary and does NOT send descript messages.
			</description>
		</method>
		<method name="ft1">
			<digest>
				Set local bar length
			</digest>
			<description>
				In the second inlet, a float sets the local bar length override. Values &lt;= 0 disable the override and resume reading from the 'bar' buffer~.
			</description>
		</method>
	</methodlist>

	<seealsolist>
		<seealso name="buildspans" />
		<seealso name="crucible" />
		<seealso name="notify" />
		<seealso name="whichoffset" />
		<seealso name="stemversion" />
		<seealso name="createproject" />
		<seealso name="growbuffer~" />
		<seealso name="dict" />
	</seealsolist>
</c74object>
