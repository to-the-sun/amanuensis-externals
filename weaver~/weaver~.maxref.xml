<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<?xml-stylesheet devhelp="true" type="text/xsl" href="pb-patcher.xsl"?>
<c74object name="weaver~" module="msp" category="Utility">
	<digest>Writes incoming track data into a polybuffer~</digest>
	<description>
		The `weaver~` object "weaves" audio from external palette buffers into a named `polybuffer~`. It monitors an incoming time ramp signal on its inlet. Each track loops individually based on its own length, derived as `main_ramp % track_length` (with a 9ms lookahead). Track lengths are calculated as the maximum bar timestamp found in the track's dictionary plus the current `bar_length` (from a "bar" buffer), and are updated every time the main ramp loops. When a track-specific ramp crosses an integer, the object looks up the corresponding bar in an external transcript dictionary. Each bar entry in the dictionary defines a `palette` (the name of an external buffer~) and an `offset`. The object then blends a continuous segment of audio from that palette buffer into the member of the `polybuffer~` corresponding to the track, using sample-accurate crossfading for smooth transitions.
	</description>
	<!--METADATA-->
	<metadatalist>
		<metadata name="author">Jules</metadata>
		<metadata name="tag">Utility</metadata>
	</metadatalist>
	<!--INLETS-->
	<inletlist>
		<inlet id="1" type="signal">
			<digest>Main time ramp (signal)</digest>
			<description>Accepts an audio signal treated as the main time ramp in milliseconds. Each track derives its own looping ramp from this signal. Integer crossings and ramp wrap-arounds on the track-specific ramps trigger dictionary lookups to weave audio.</description>
		</inlet>
	</inletlist>
	<!--OUTLETS-->
	<outletlist>
		<outlet id="1" type="int">
			<digest>Outlet 1: Track ID on Loop</digest>
			<description>Whenever a track's individual ramp loops (including when the main ramp loops), it outputs an integer corresponding to that track ID.</description>
		</outlet>
		<outlet id="2" type="anything">
			<digest>Outlet 2: Logging Outlet</digest>
			<description>Outputs diagnostic information when the log attribute is enabled.</description>
		</outlet>
	</outletlist>
	<!--ARGUMENTS-->
	<objarglist>
		<objarg name="dictionary" type="symbol" optional="0">
			<digest>Name of the dictionary to reference</digest>
		</objarg>
		<objarg name="polybuffer" type="symbol" optional="0">
			<digest>Name of the polybuffer~ to reference</digest>
		</objarg>
	</objarglist>
	<!--MESSAGES-->
	<methodlist>
		<method name="anything">
			<digest>Change transcript dictionary or set maximum tracks</digest>
			<description>Accepts a symbol to change the name of the transcript dictionary being referenced. Also accepts the message `tracks` followed by an integer to set the maximum number of tracks to process.</description>
		</method>
		<method name="dsp64">
			<digest>DSP method</digest>
		</method>
	</methodlist>
	<!--ATTRIBUTES-->
	<attributelist>
		<attribute name="tracks" type="long" get="1" set="1" opaque="0">
			<digest>Number of Tracks</digest>
			<description>The maximum number of tracks to process from the transcript dictionary (default is 4).</description>
		</attribute>
		<attribute name="log" type="long" get="1" set="1" opaque="0">
			<digest>Enable Logging</digest>
			<attributelist>
				<attribute name="style" get="1" set="1" type="symbol" size="1" value="onoff" />
			</attributelist>
		</attribute>
		<attribute name="low" type="double" get="1" set="1" opaque="0">
			<digest>Low Limit (ms)</digest>
			<description>Minimum ramp time for crossfades in milliseconds.</description>
		</attribute>
		<attribute name="high" type="double" get="1" set="1" opaque="0">
			<digest>High Limit (ms)</digest>
			<description>Maximum ramp time for crossfades in milliseconds.</description>
		</attribute>
	</attributelist>
	<!--SEEALSO-->
	<seealsolist>
		<seealso name="crucible" />
		<seealso name="buildspans" />
	</seealsolist>
</c74object>
